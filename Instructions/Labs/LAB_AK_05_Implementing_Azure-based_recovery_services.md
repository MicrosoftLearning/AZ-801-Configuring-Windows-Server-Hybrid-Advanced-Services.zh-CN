---
lab:
  title: 实验室：实现基于 Azure 的恢复服务
  type: Answer Key
  module: 'Module 5: Planning and implementing migration and recovery services in hybrid scenarios'
ms.openlocfilehash: 57aeb2d0bbcc6a67e44e5f22a874959c6ae9e1e0
ms.sourcegitcommit: 9a51ea796ef3806ab9e7ec1ff75034b2f929ed2a
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/28/2022
ms.locfileid: "137907080"
---
# <a name="lab-answer-key-implementing-azure-based-recovery-services"></a>实验室答案：实现基于 Azure 的恢复服务

## <a name="exercise-1-creating-and-configuring-an-azure-site-recovery-vault"></a>练习 1：创建和配置 Azure Site Recovery 保管库

#### <a name="task-1-create-an-azure-site-recovery-vault"></a>任务 1：创建 Azure Site Recovery 保管库

1. 连接到 SEA-SVR2，并根据需要，以 CONTOSO\\Administrator 的身份，使用密码 Pa55w.rd 登录  。
1. 在 SEA-SVR2 上，启动 Microsoft Edge，转到 [Azure 门户](https://portal.azure.com)，然后使用具有所有者角色的用户帐户的凭据登录要在此实验室中使用的订阅 。
1. 在 Azure 门户中，在工具栏上的“搜索资源、服务和文档”文本框，搜索并选择“恢复服务保管库”，然后在“恢复服务保管库”页上，选择“+ 创建”   。
1. 在“创建恢复服务保管库”页的“基本信息”选项卡上，指定以下设置（将其他设置保留为默认值）并选择“查看 + 创建”  ：

   |设置|值|
   |---|---|
   |订阅|将在此实验室中使用的 Azure 订阅的名称|
   |资源组|新资源组 AZ801-L0501-RG 的名称|
   |保管库名称|az801l05a-rsvault|
   |位置|可用于创建 Azure 恢复服务保管库且靠近实验室环境位置的 Azure 区域的名称|

1. 在“创建恢复服务保管库”页的“查看 + 创建”选项卡上，选择“创建”  。

   > 注意：请等待恢复服务保管库预配完成。 这大约需要 2 分钟。

   > 注意：默认情况下，保管库的存储复制类型设置为异地冗余 (GRS)，并且启用了软删除和安全功能。 你将在实验室中更改这些设置以简化取消预配，但应确保在生产环境中启用它们。

#### <a name="task-2-configure-the-azure-site-recovery-vault"></a>任务 2：配置 Azure Site Recovery 保管库

1. 在“SEA-SVR2”上，在显示 Azure 门户的 Microsoft Edge 窗口中，在部署页面上选择“转到资源” 。 

   > 注意：这将自动显示“az801l05a-rsvault”页 。

1. 在“az801l05a`-rsvault”页左侧垂直菜单的“设置”部分中，选择“属性”  。 
1. 在“az801l05a-rsvault | 属性”页上，选择“备份配置”标签下的“更新”链接  。
1. 在“备份配置”页上，将“存储复制类型”设置为“本地冗余”，选择“保存”并关闭“备份配置”页    。

   > 注意：实现保护后无法更改存储复制类型。

1. 在“az801l05a-rsvault | 属性”页上，选择“安全设置”标签下的“更新”链接  。
1. 在“安全设置”页上，将“软删除”设置为“禁用”，将“安全功能”设置为“禁用”，选择“保存”，然后关闭“安全设置”页      。

## <a name="exercise-2-implementing-hyper-v-vm-protection-by-using-azure-site-recovery-vault"></a>练习 2：使用 Azure Site Recovery 保管库实现 Hyper-V VM 保护

#### <a name="task-1-implement-an-azure-recovery-site"></a>任务 1：实现 Azure 恢复站点

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，使用工具栏中的“搜索资源、服务和文档”文本框搜索并选择“虚拟网络”，在“虚拟网络”页上选择“+ 创建”    。
1. 在“创建虚拟网络”页的“基本信息”选项卡上，指定以下设置（将其他设置保留为默认值）并选择“下一步: IP 地址”  ：

   |设置|值|
   |---|---|
   |订阅|你在此实验室中使用的 Azure 订阅的名称|
   |资源组|新资源组 AZ801-L0502-RG 的名称|
   |名称|az801l05-dr-vnet|
   |区域|你在本实验室前面部署了恢复服务保管库的 Azure 区域的名称|

1. 在“创建虚拟网络”页的“IP 地址”选项卡上，选择回收站图标，在“IPv4 地址空间”文本框中输入“10.5.0.0/22”并选择“+ 添加子网”    。
1. 在“添加子网”页上，指定以下设置（将其他设置保留为默认值），然后选择“添加” ：

   |设置|值|
   |---|---|
   |子网名称|subnet0|
   |子网地址范围|**10.5.0.0/24**|

1. 回到“创建虚拟网络”页面的“IP 地址”选项卡上，选择“查看 + 创建”  。
1. 在“创建虚拟网络”页的“查看 + 创建”选项卡上，选择“创建”  。
1. 在 Azure 门户中的“SEA-SVR2”上，浏览回“虚拟网络”页并选择“+ 创建”  。
1. 在“创建虚拟网络”页的“基本信息”选项卡上，指定以下设置（将其他设置保留为默认值）并选择“下一步: IP 地址”  ：

   |设置|值|
   |---|---|
   |订阅|你在此实验室中使用的 Azure 订阅的名称|
   |资源组|AZ801-L0502-RG|
   |名称|az801l05-test-vnet|
   |区域|你在本实验室前面部署了恢复服务保管库的 Azure 区域的名称|

1. 在“创建虚拟网络”页的“IP 地址”选项卡上，选择回收站图标，在“IPv4 地址空间”文本框中输入“10.5.0.0/22”并选择“+ 添加子网”    。

   > 注意：忽略有关 IP 地址空间重叠的警告。 这是有意为之，是为了确保测试环境的 IP 地址空间与灾难恢复环境的 IP 地址空间相匹配。

1. 在“添加子网”页上，指定以下设置（将其他设置保留为默认值），然后选择“添加” ：

   |设置|值|
   |---|---|
   |子网名称|subnet0|
   |子网地址范围|**10.5.0.0/24**|

1. 回到“创建虚拟网络”页面的“IP 地址”选项卡上，选择“查看 + 创建”  。
1. 在“创建虚拟网络”页的“查看 + 创建”选项卡上，选择“创建”  。
1. 在 SEA-SVR2 上，在 Azure 门户中使用工具栏中的“搜索资源、服务和文档”文本框搜索并选择“存储帐户”，然后在“存储帐户”页上，选择“+ 创建”    。
1. 在“创建存储帐户”页的“基本信息”选项卡上，指定以下设置（将其他设置保留为默认值） ：

   |设置|值|
   |---|---|
   |订阅|你在此实验室中使用的 Azure 订阅的名称|
   |资源组|AZ801-L0502-RG|
   |存储帐户名称|长度在 3 到 24 之间的任何全局唯一名称，由字母和数字组成，以字母开头|
   |区域|你在本实验室前面部署了恢复服务保管库的 Azure 区域的名称|
   |性能|标准|
   |冗余|本地冗余存储 (LRS)|

1. 在“创建存储帐户”页的“基本信息”选项卡上，选择“数据保护”选项卡  。
1. 在“创建存储帐户”页的“数据保护”选项卡上，清除“为 Blob 启用软删除”和“为容器启用软删除”复选框，然后选择“查看 + 创建”    。

   > 注意：在使用 Azure Site Recovery 的存储帐户时必须禁用这些设置。

1. 在“创建存储帐户”页的“查看 + 创建”选项卡上，选择“创建”  。

#### <a name="task-2-prepare-protection-of-a-hyper-v-virtual-machine"></a>任务 2：准备 Hyper-V 虚拟机的保护

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，使用工具栏中的“搜索资源、服务和文档”文本框搜索并选择“恢复服务保管库”，然后在“恢复服务保管库”页上，选择“az801l05a-rsvault”条目    。
1. 在“az801l05a-rsvault”页左侧垂直菜单的“入门”部分中，选择“Site Recovery”  
1. 在“az801l05a-rsvault \| Site Recovery”页的“Hyper-V 计算机到 Azure”部分中，选择“1. 准备基础结构”  。 
1. 在“准备基础结构”页的“部署规划”选项卡的“部署规划已完成?”下拉列表中，选择“是，我已完成”并选择“下一步”    。
1. 在“准备基础结构”页的“源设置”选项卡上，在“是否使用 System Center VMM 来管理 Hyper-V 主机”标签旁边，选择“否”选项   。
1. 在“准备基础结构”页的“源设置”选项卡上，选择“添加 Hyper-V 站点”链接  。 
1. 在“创建 Hyper-V 站点”页的“名称”文本框中，输入“az801l05-site”并选择“确定”   ：
1. 在“准备基础结构”页的“源设置”选项卡上，选择“添加 Hyper-V 服务器”链接  。 
1. 在“添加服务器”页上，选择添加本地 Hyper-V 主机过程步骤 3 中的下载链接，以下载 Microsoft Azure Site Recovery 提供程序的安装程序 。

   > 注意：如果你收到有关 AzureSiteRecoveryProvider.exe 无法安全下载的 Microsoft Edge 通知，请将光标移到消息右侧以显示省略号 (…)，将其选中，在下拉菜单中选择“复制下载链接”，在同一 Microsoft Edge 窗口中打开另一个选项卡，粘贴你复制的链接，然后按 Enter   。

1. 在下载通知中，选择“打开文件”。 这将启动 Azure Site Recovery Provider Setup（Hyper-V 服务器）向导。
1. 在“Microsoft 更新”页上，选择“关闭”，然后选择“下一步”  。
1. 在“提供程序安装”页上，选择“安装” 。
1. 切换到显示 Azure 门户的 Microsoft Edge 窗口，并在“添加服务器”页中，在注册本地 Hyper-V 主机过程的第 4 步中选择“下载”按钮，以下载保管库注册密钥。
1. 切换到提供程序安装向导，然后选择“注册” 。 这将启动 Microsoft Azure Site Recovery 注册向导。
1. 在 Microsoft Azure Site Recovery 注册向导的“保管库设置”页上，选择“浏览”  。 
1. 在“打开”窗口中，浏览到“下载”文件夹，选择保管库凭据文件，然后选择“打开”  。
1. 返回 Microsoft Azure Site Recovery 注册向导的“保管库设置”页上，选择“下一步”  。
1. 在 Microsoft Azure Site Recovery 注册向导的“代理设置”页上，接受默认设置，然后选择“下一步”  。
1. 在 Microsoft Azure Site Recovery 注册向导的“注册”页上，选择“完成”  。

   > 注意：如果注册失败，请选择“启动” 。 在“开始”菜单上，选择“Azure Site Recovery 服务提供程序”文件夹 。 在该文件夹中，选择“Azure Site Recovery 配置器”，然后重新运行注册过程。

1. 切换回显示 Azure 门户的 Microsoft Edge 窗口，关闭“添加服务器”页，然后刷新该页。 收到提示时，选择“重新加载”。 
1. 返回到“az801l05a-rsvault | Site Recovery”页的“Hyper-V 计算机到 Azure”部分中，选择“1. 准备基础结构”  。 
1. 在“准备基础结构”页的“部署规划”选项卡的“部署规划已完成?”下拉列表中，选择“是，我已完成”并选择“下一步”    。
1. 在“准备基础结构”页的“源设置”选项卡上，在“是否使用 System Center VMM 来管理 Hyper-V 主机”标签旁边，选择“否”选项   。
验证“Hyper-V 站点”和“Hyper-V 服务器”设置是否正确设置，然后选择“下一步”  。 
1. 在“准备基础结构”页的“目标设置”选项卡上，接受默认设置并选择“下一步”  。
1. 在“准备基础结构”页的“复制策略”选项卡上，选择“创建新策略并关联”  。 
1. 在“创建关联策略”页上，指定以下设置（将其他设置保留为默认值），然后选择“确定” ：

   |设置|值|
   |---|---|
   |名称|az801l05-replication-policy|
   |复制频率|**30 秒**|

1. 返回到“准备基础结构”页的“复制策略”选项卡上，等待网站与策略进行关联，然后选择“下一步”  。
1. 在“准备基础结构”页的“查看”选项卡上，选择“准备”  。

#### <a name="task-3-enable-replication-of-a-hyper-v-virtual-machine"></a>任务 3：启用 Hyper-V 虚拟机的复制

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“az801l05a-rsvault \| Site Recovery”页上，在“Hyper-V 计算机到 Azure”部分中，选择“2. 启用复制”   。 
1. 在“启用复制”页的“源环境”选项卡上，在“源位置”下拉列表中，选择“az801l05-site”并选择“下一步”    。
1. 在“启用复制”页的“目标环境”选项卡上，指定以下设置（其他设置保留默认值）并选择“下一步”  ：

   |设置|值|
   |---|---|
   |订阅|你在此实验室中使用的 Azure 订阅的名称|
   |故障转移后资源组|AZ801-L0502-RG|
   |故障转移后部署模型|**资源管理器**|
   |存储帐户|在此练习的第一个任务中创建的存储帐户的名称|
   |Azure 网络|立即为所选计算机配置|
   |虚拟网络|az801l05-dr-vnet|
   |子网|subnet0 (10.5.0.0/24)|

1. 在“启用复制”页的“虚拟机选择”选项卡上，选中“SEA-CORE1”复选框并选择“下一步”   。
1. 在“启用复制”页的“复制设置”选项卡上，在“默认”行和“OS 类型”列中，从下拉列表中选择“Windows”，然后选择“下一步”     。
1. 在“启用复制”页的“复制策略”选项卡上，接受默认设置，然后选择“下一步”  。
1. 在“启用复制”页的“查看”选项卡上，选择“启用复制”  。

#### <a name="task-4-review-azure-vm-replication-settings"></a>任务 4：查看 Azure VM 复制设置

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，回到“az801l05a-rsvault \| Site Recovery”页，在左侧的垂直菜单中，选择“复制项目”  。 
1. 在“az801l05a-rsvault \| 已复制项”页上，确保有一个表示 SEA-CORE1 虚拟机的条目，并验证其“复制运行状况”是否列为“正常”，其“状态”是否列为“启用保护”或显示同步进度的当前百分比     。

   > 注意：可能需要等待几分钟，直到 SEA-CORE1 条目出现在“az801l05a-rsvault \| 已复制项”页上  。

1. 在“az801l05a-rsvault \| 已复制的项”页上，选择“SEA-CORE1”条目 。
1. 在 SEA-CORE1 已复制项页上，查看“运行状况和状态”、“故障转移准备情况”、“最新恢复点”和“基础结构视图”部分    。 注意“计划内故障转移”、“故障转移”和“测试故障转移”工具栏图标  。

   > 注意：等待状态更改为“受保护” 。 执行此操作所需的时间取决于实验室环境与托管恢复服务保管库的 Azure 区域之间的连接的可用带宽。 你需要刷新浏览器页面才能更新状态。 

1. 在 SEA-CORE1 已复制项页上，选择最新恢复点，并查看“最新崩溃一致”恢复点和“最新应用一致”恢复点   。 

#### <a name="task-5-perform-a-failover-of-the-hyper-v-virtual-machine"></a>任务 5：执行 Hyper-V 虚拟机的故障转移

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，返回到“SEA-CORE1 | 已复制项”页，然后选择“测试故障转移”  。 
1. 在“测试故障转移”页上，指定以下设置（将其他设置保留为默认值），然后选择“确定” ：

   |设置|值|
   |---|---|
   |选择恢复点|默认选项|
   |Azure 虚拟网络|az801l05-test-vnet|

1. 在 Azure 门户中，浏览回“az801l05a-rsvault”页面，然后在左侧垂直菜单的“监视”部分中选择“站点恢复作业”  。 等到“测试故障转移”作业的状态列为“成功” 。

   > 注意：完成测试故障转移所需的时间取决于实验室环境与托管恢复服务保管库的 Azure 区域之间的连接的可用带宽。 你需要刷新浏览器页面才能更新状态。 

   > 注意：在等待测试故障转移完成时，继续练习 3，完成后，逐步完成此练习的剩余部分。

1. 在 Azure 门户中，使用工具栏上的“搜索资源、服务和文档”文本框，搜索并选择“虚拟机”，然后在“虚拟机”页上，记下表示新复制的虚拟机的条目  。

   > 注意：最初，虚拟机的名称由 asr- 前缀和随机生成的后缀组成，但最终将重命名为 SEA-CORE1-test  。

1. 在 Azure 门户中，浏览回 SEA-CORE1 已复制项页，并选择“清理测试故障转移” 。
1. 在“测试故障转移清理”页上，选择“测试完成。请删除测试故障转移虚拟机”复选框并选择“确定”  。
1. 测试故障转移清理作业完成后，刷新显示 SEA-CORE1 已复制项页的浏览器页面，并注意你可以选择执行计划内和计划外故障转移（后者标记为“故障转移”） 。

   > 注意：计划外故障转移选项标记为“故障转移” 。

1. 在 SEA-CORE1 已复制项页上，选择“计划内故障转移” 。 
1. 在“计划内故障转移”页上，注意故障转移方向设置已设置且不可修改。 
1. 在不启动故障转移的情况下关闭“计划内故障转移”页，然后在 SEA-CORE1 已复制项页上选择“故障转移”  。 
1. 在“故障转移”页上，注意可以选择恢复点。 
1. 关闭“故障转移”页，而不启动故障转移。

## <a name="exercise-3-implementing-azure-backup"></a>练习 3：实现 Azure 备份

#### <a name="task-1-set-up-the-azure-recovery-services-agent"></a>任务 1：设置 Azure 恢复服务代理

> 注意：通常，可使用同一个保管库实现 Azure Site Recovery 和 Azure 备份功能。 在选择 Azure 区域来托管用于灾难恢复和备份的保管库时，应考虑恢复目标，包括区域灾难的影响范围以及网络延迟注意事项。 在此实验室中，你将使用同一个保管库进行站点恢复和备份，以尽量减少重复步骤的数量。 

> 注意：要实现 Azure 备份，你将在 Sea-SVR2 上安装 Azure 恢复服务代理，该代理已作为 Microsoft Azure Site Recovery 提供程序  。 为了消除依赖问题，首先要卸载 Azure 恢复服务代理的现有安装。

1. 在 SEA-SVR2 上选择“开始”，然后在“开始”菜单上选择“设置”应用   。
1. 在“设置”应用中，选择“应用” 。
1. 在“应用和功能”窗格中，选择“Microsoft Azure 恢复服务代理”，选择“卸载”，然后按照提示将其卸载 。
   > 注意：如果收到提示安装失败的错误消息，请重启 VM 并重试。 
1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，在 az801l05a-rsvault 恢复服务保管库页的左侧垂直菜单中，在“开始”部分，选择“备份”   。
1. 在“az801l05a-rsvault \| 备份”页上，指定以下设置：

   |设置| 值|
   |---|---|
   |你的工作负载在哪里运行?|**本地**|
   |你希望备份什么?|**文件和文件夹**|

1. 在“az801l05a-rsvault \| 备份”页上，选择“准备基础结构” 。
1. 在“准备基础结构”页上，选择“Windows 服务器或 Windows 客户端链接的下载代理” 。
1. 下载完成后，在 Microsoft Edge 的“下载”通知中，选择“打开文件”链接 。 

   > 注意：这将启动 Microsoft Azure 恢复服务代理安装向导，这种情况下将自动启动注册服务器向导  。

1. 在 Microsoft Azure 恢复服务代理安装向导的“安装设置”页上，接受默认设置并选择“下一步”  。
1. 在 Microsoft Azure 恢复服务代理安装向导的“代理配置”页上，接受默认设置，然后选择“下一步”  。
1. 在 Microsoft Azure 恢复服务代理安装向导的“Microsoft 更新选择加入”页上，选择“我不想使用 Windows 更新”，然后选择“下一步”   。
1. 在 Microsoft Azure 恢复服务代理安装向导的“安装”页上，选择“安装”  。
1. 安装完成后，在 Microsoft Azure 恢复服务代理安装向导的“安装”页上，选择“继续注册”  。 这将启动注册服务器向导。
1. 切换到显示 Azure 门户的 Microsoft Edge 窗口，在“准备基础结构”页上，选中“已下载或正在使用最新的恢复服务器代理”复选框，然后选择“下载”  。
1. 当系统提示是打开还是保存保管库凭据文件时，请选择“保存”。 这会将保管库凭据文件保存到本地的“下载”文件夹。
1. 切换回注册服务器向导，然后在“保管库标识”页上选择“浏览”  。
1. 在“选择保险库凭据”对话框中，浏览到“下载”文件夹，选择你下载的保险库凭据文件，然后选择“打开”  。 然后选择“下一步”，打开“加密设置”页 。
1. 在注册服务器向导的“加密设置”页上，选择“生成密码”  。
1. 在注册服务器向导的“加密设置”页上，选择“输入用于保存密码的位置”下拉列表旁边的“浏览”按钮   。
1. 在“浏览文件夹”对话框中，展开“此计算机”节点，选择“文档”子文件夹，然后选择“确定”   。
1. 选择“完成”，查看 Microsoft Azure 备份警告，选择“是”，然后等待注册完成  。

   > 注意：在生产环境中，你应该将密码短语文件存储在要备份的服务器之外的安全位置。

1. 在注册服务器向导的“服务器注册”页上，查看有关密码文件位置的警告，确保已选中“启动 Microsoft Azure 恢复服务代理”复选框，然后选择“关闭”   。 这将自动打开 Microsoft Azure 备份控制台。

#### <a name="task-2-schedule-azure-backup"></a>任务 2：计划 Azure 备份

1. 在 SEA-SVR2 上，在 Microsoft Azure 备份控制台的“操作”窗格中，选择“计划备份”  。
1. 在计划备份向导的“开始”页上，选择“下一步”  。
1. 在“选择要备份的项”页上，选择“添加项” 。
1. 在“选择项目”对话框中，浏览到“C:\\Windows\\System32\\drivers\\etc\\”文件夹，选择“hosts”，然后选择“确定”   ：
1. 在“选择要备份的项”页上，选择“下一步” 。
1. 在“指定备份计划”页上，确保“在以下时间(最多允许一天三次)”框下方的第一个下拉列表框中选择了“天”选项，选择“凌晨 4:30”，然后选择“下一步”    。
1. 在“选择保留策略”页上，接受默认设置，然后选择“下一步” 。
1. 在“选择初始备份类型”页上，接受默认值，然后选择“下一步” 。
1. 在“确认”页上，选择“完成” 。 创建备份计划后，选择“关闭”。

#### <a name="task-3-perform-an-on-demand-backup"></a>任务 3：执行按需备份

> 注意：创建计划备份后，按需运行备份的选项变为可用。

1. 在“Microsoft Azure 备份”控制台的“操作”窗格中，选择“立即备份” 。
1. 在立即备份向导的“选择备份项”页上，确保已选中“文件和文件夹”选项并选择“下一步”   。
1. 在“保留备份截止日期”页上，接受默认设置并选择“下一步” 。
1. 在“确认”页上，选择“备份” 。
1. 备份完成后，选择“关闭”。
1. 在 SEA-SVR2 上，切换到显示 Azure 门户的 Microsoft Edge 窗口，浏览回 az801l05a-rsvault 恢复服务保管库页，并选择“备份项”  。 
1. 在“az801l05a-rsvault \| 备份项”页上，选择“Azure 备份代理”条目 。
1. 在“备份项目(Azure 备份代理)”页上，验证是否存在引用 sea-svr2.contoso.com 的驱动器 C 的条目  。

#### <a name="task-4-perform-file-recovery-by-using-azure-recovery-services-agent"></a>任务 4：使用 Azure 恢复服务代理执行文件恢复

1. 在 SEA-SVR2 上，打开文件资源管理器，浏览到 **C:\\Windows\\System32\\drivers\\etc\\** 文件夹，并删除 hosts 文件 。
1. 切换到“Microsoft Azure 备份”窗口并选择“恢复数据”。 这将启动恢复数据向导。
1. 在恢复数据向导的“入门”页上，确保已选中“此服务器(sea-svr2.contoso.com)”选项并选择“下一步”   。
1. 在“选择恢复模式”页面上，确保已选中“单个文件和文件夹”选项，然后选择“下一步”  。
1. 在“选择卷和日期”页的“选择卷”下拉列表中，选择“C:\\”，接受可用备份的默认选择，然后选择“装载”   。 

   > 注意：等待装载操作完成。 这可能需要大约 2 分钟。

1. 在“浏览和恢复文件”页面上，记下恢复卷的盘符，选择“浏览”，然后查看有关使用 Robocopy 的提示  。 
1. 选择“开始”，展开“Windows 系统”文件夹，然后选择“命令提示符”  。
1. 在“Administrator: 命令提示符”窗口中，运行以下命令，将 hosts 文件复制并还原到原始位置（将 `<recovery_volume>` 占位符替换为你之前确定的恢复卷的盘符） ：

   ```cmd
   robocopy <recovery_volume>:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. 在“Administrator: 命令提示符”窗口中，运行以下命令，验证文件是否已恢复：

   ```cmd
   dir C:\Windows\system32\drivers\etc\hosts
   ```

1. 切换回恢复数据向导，在“浏览和恢复文件”页上，选择“卸载”，并在提示确认时选择“是”   。 

## <a name="exercise-4-deprovisioning-the-azure-lab-environment"></a>练习 4：取消预配 Azure 实验室环境

#### <a name="task-1-remove-the-protected-items"></a>任务 1：删除受保护的项

1. 在 SEA-SVR2 上，切换到显示 Azure 门户的“备份项(Azure 备份代理)”页的 Microsoft Edge 窗口，然后选择引用 sea-svr2.contoso.com 的 C 盘的条目   。
1. 在 sea-svr2.contoso.com 上的 C:\\ 页面上，选择 sea-svr2.contoso.com 链接 。
1. 在 sea-svr2.contoso.com 页上，选择“删除” 。 
1. 在“删除”页上，指定以下信息，选择“有 1 个备份项的备份数据与此服务器相关联。我了解单击‘确认’将永久删除所有云备份数据。此操作无法撤消。可能会向此订阅的管理员发送警报，通知他们此删除操作”复选框，然后选择“删除”  ：

   |设置| 值|
   |---|---|
   |键入服务器名称|sea-svr2.contoso.com|
   |原因|**已停用**|
   |注释|**已停用**|

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 中，浏览到“az801l05a-rsvault | 已复制项”页，然后选择 SEA-CORE1 条目  。
1. 在 SEA-CORE1 已复制项页上，选择工具栏中的省略号，然后从下拉菜单中选择“禁用复制” 。 
1. 在“禁用复制”页上，确保“禁用复制并删除(推荐)”条目出现在“删除复制项”下拉列表中，选择“我不想提供反馈”复选框，然后选择“确定”    。

#### <a name="task-2-delete-the-lab-resource-groups"></a>任务 2：删除实验室资源组

1. 在 SEA-SVR2 上，在显示 Azure 门户的 Microsoft Edge 窗口中，通过选择 Azure 门户中的 Cloud Shell 按钮打开“Azure Cloud Shell”窗格。
1. 如果系统提示选择“Bash”或“PowerShell”，请选择“PowerShell”  。

   > 注意：如果这是你第一次启动 Cloud Shell 且向你显示了“未装载任何存储”消息，请选择要在此实验室中使用的订阅，然后选择“创建存储”  。

1. 在 Cloud Shell 窗格中，运行以下命令，列出你在此实验室中创建的所有资源组：

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L050*'
   ```

   > 注意：验证输出中是否仅包含你在此实验室中创建的资源组。 此任务中将删除该组。

1. 在 Cloud Shell 窗格中，运行以下命令，删除在此实验室过程中创建的所有资源组：

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L050*' | Remove-AzResourceGroup -Force -AsJob
   ```

   > 注意：该命令以异步方式执行（由 -AsJob 参数决定），因此，虽然你可以随后立即在同一个 PowerShell 会话中运行另一个 PowerShell 命令，但需要几分钟才能实际删除资源组。